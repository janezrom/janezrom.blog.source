---
title:  Static blog with hakyll
date:   2015-10-5
author: Janez Rom
tags:   linux, static blog
---

# Install hakyll

    cabal install hakyll

Initialise blog

    hakyll-init ~/blog/janezrom.github.io
    cd  ~/blog/janezrom.github.io

To compile with threaded and dynamic option, you must enable them before - see installing haskell.

    ghc --make -threaded -dynamic site.hs
    ./site build

    ./site watch

and have a look at your site at http://localhost:8000/ or http://127.0.0.1:8000/

I store blog posts in separate directory linking them to hakyll blog.

    ln -s  ~/documents/posts/ /home/janez/blog/janezrom.github.io/posts

In case of error message “Could not find module”Hakyll“”

    cabal install --reinstall --enable-shared hakyll

In case of problem of compiling with dynamic/share haskell (had a problem with pandoc) then disable dynamic/shared when installing haskell programs.

# Put blog on GitHub

## Initialize

Create github directory

    janezrom.github.io

Initialize a git repository and set up synchronization with it’s github counterpart with

    cd ~/blog/janezrom.github.io/_site
    git init
    git add *.html # add css, etc.
    git commit -m "initial import"
    git remote add origin https://github.com/janezrom/janezrom.github.io.git
    git push -u origin master

## Push new commit - check

    git commit -a -m "new commit"
    git push -u origin master

## Save blog source

You must have created you blog directory. My is janezrom.github.io

Initialize a git repository and set up synchronization with it’s github counterpart with

    cd ~/blog/janezrom.github.io

    git init

Create .gitignore file and put in

    .git
    .stack-work
    _cache
    _site
    site
    site.hi
    site.o
    stack.yaml.lock

Continue

    git add *
    git commit -m "initial import"
    git remote add origin https://github.com/janezrom/janezrom.blog.source.git
    git push -u origin master

Push new commit - check

    git commit -a -m "new commit"
    git push -u origin master

# MathJax

Install mathjax

    pacman -S mathjax

Modify site.hs file by adding on the top

    import qualified Data.Set as S
    import           Text.Pandoc.Options

and at the end

    pandocMathCompiler =
        let mathExtensions = [Ext_tex_math_dollars, Ext_tex_math_double_backslash,
                              Ext_latex_macros]
            defaultExtensions = writerExtensions defaultHakyllWriterOptions
            newExtensions = foldr S.insert defaultExtensions mathExtensions
            writerOptions = defaultHakyllWriterOptions {
                              writerExtensions = newExtensions,
                              writerHTMLMathMethod = MathJax ""
                            }
        in pandocCompilerWith defaultHakyllReaderOptions writerOptions

Finaly replace all instances of pandocCompiler with pandocMathCompiler.

Add the following HTML to your default.html template to point users to Mathjax:

    <script type="text/javascript"
            src="http://cdn.mathjax.org/mathjax/latest/MathJax.js?config=TeX-AMS-MML_HTMLorMML"></script>

# Code higlighting

Create file css/syntax.css with following content

    pre.sourceCode {
        background-color: #f8f8f8;
        border: 2px solid #ddd;
        padding: 6px 10px;
        border-radius: 5px;
        overflow-x: auto;
        font-size: 14px;
    }

    /* Generated by pandoc. */
    table.sourceCode, tr.sourceCode, td.lineNumbers, td.sourceCode, table.sourceCode pre
       {
           margin: 0;
           padding: 0;
           border: 0;
           vertical-align: baseline;
           border: none;
       }
    td.lineNumbers {
        border-right: 1px solid #AAAAAA;
        text-align: right; color: #AAAAAA;
        padding-right: 5px;
        padding-left: 5px;
    }
    td.sourceCode { padding-left: 5px; }
    .sourceCode span.kw { color: #007020; font-weight: bold; }
    .sourceCode span.dt { color: #902000; }
    .sourceCode span.dv { color: #40a070; }
    .sourceCode span.bn { color: #40a070; }
    .sourceCode span.fl { color: #40a070; }
    .sourceCode span.ch { color: #4070a0; }
    .sourceCode span.st { color: #4070a0; }
    .sourceCode span.co { color: #60a0b0; font-style: italic; }
    .sourceCode span.ot { color: #007020; }
    .sourceCode span.al { color: red; font-weight: bold; }
    .sourceCode span.fu { color: #06287e; }
    .sourceCode span.re { }
    .sourceCode span.er { color: red; font-weight: bold; }

and add reference to him at head of file templates/default.html

        <link rel="stylesheet" type="text/css" href="/css/syntax.css" />
